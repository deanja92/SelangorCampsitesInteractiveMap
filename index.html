<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Campsites Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            height: 100vh;
            overflow: hidden;
            margin: 0;
        }
        #map { height: 80vh; width: 100%; }
        #controls { display: flex; justify-content: center; padding: 10px; gap: 10px; }
        button, select, input { padding: 10px; border-radius: 5px; border: none; }
        .error-message { color: red; text-align: center; display: none; }
    </style>
</head>
<body>
    <div id="controls">
        <input type="text" id="search-box" placeholder="Search campsites...">
        <button id="search-button">Search</button>
        <select id="filter-type">
            <option value="all">All</option>
            <option value="park">Parks</option>
            <option value="lake">Lakes</option>
            <option value="forest">Forests</option>
        </select>
        <button id="geo-button">Find Me</button>
        <select id="map-theme">
            <option value="street">Street</option>
            <option value="satellite">Satellite</option>
            <option value="terrain">Terrain</option>
        </select>
    </div>
    <p class="error-message" id="error-message">Error loading campsites. Please try again.</p>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>
    <script>
        var map = L.map('map').setView([3.0, 101.5], 10);
        var markerCluster = L.markerClusterGroup();
        var markers = {};

        var layers = {
            street: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap' }),
            satellite: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', { attribution: '© OpenTopoMap' }),
            terrain: L.tileLayer('https://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png?apikey=your_api_key', { attribution: '© Thunderforest' })
        };

        layers.street.addTo(map);

        document.getElementById('map-theme').addEventListener('change', function() {
            map.eachLayer(layer => map.removeLayer(layer));
            layers[this.value].addTo(map);
        });

        function getColor(type) {
            return type === 'park' ? '#4CAF50' : type === 'lake' ? '#2196F3' : type === 'forest' ? '#8BC34A' : '#FF9800';
        }

        function addMarkers(data) {
            data.forEach(site => {
                let marker = L.marker([site.Latitude, site.Longitude]).bindPopup(`<b>${site.Name}</b><br>${site.Address}`);
                markerCluster.addLayer(marker);
                markers[site.Name] = marker;
            });
            map.addLayer(markerCluster);
        }

        fetch('data.json').then(res => res.json()).then(data => {
            document.getElementById('error-message').style.display = 'none';
            window.campsites = data;
            new Awesomplete(document.getElementById('search-box'), { list: data.map(c => c.Name) });
            addMarkers(data);
        }).catch(() => document.getElementById('error-message').style.display = 'block');

        document.getElementById('search-button').addEventListener('click', function() {
            let query = document.getElementById('search-box').value.toLowerCase();
            let result = window.campsites.find(c => c.Name.toLowerCase().includes(query));
            if (result) {
                map.setView([result.Latitude, result.Longitude], 15);
                markers[result.Name].openPopup();
            }
        });

        document.getElementById('geo-button').addEventListener('click', function() {
            navigator.geolocation.getCurrentPosition(pos => {
                let userMarker = L.marker([pos.coords.latitude, pos.coords.longitude]).bindPopup("You are here").addTo(map);
                map.setView([pos.coords.latitude, pos.coords.longitude], 14);
            }, () => alert("Geolocation not available"));
        });

        document.getElementById('filter-type').addEventListener('change', function() {
            let selectedType = this.value;
            markerCluster.clearLayers();
            window.campsites.filter(c => selectedType === 'all' || c.Type === selectedType).forEach(site => {
                markerCluster.addLayer(markers[site.Name]);
            });
            map.addLayer(markerCluster);
        });
    </script>
</body>
</html>
